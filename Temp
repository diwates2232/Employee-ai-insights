// src/pages/DashboardHome.jsx

import React from 'react';
import { Link } from 'react-router-dom';
import { Row, Col, Tabs, Tab, ListGroup, Card, Container } from 'react-bootstrap';

import SummaryCards from '../components/SummaryCards';
import SummaryChart from '../components/SummaryChart';
import FloorOccupancyChart from '../components/FloorOccupancyChart';
import PersonnelTypeBreakdownTable from '../components/PersonnelTypeBreakdownTable';

// Helper: Group zones by floor
function groupZonesByFloor(zoneBreakdown) {
  const grouped = {};
  for (const zone of zoneBreakdown || []) {
    const floor = zone.floor || 'Unknown Floor';
    if (!grouped[floor]) grouped[floor] = [];
    grouped[floor].push(zone);
  }
  return grouped;
}

export default function DashboardHome({
  summaryData,
  detailsData,
  floorData,
  zoneBreakdown,
  personnelBreakdown,
  personnelSummary
}) {
  const employees = personnelSummary?.employees ?? 0;
  const contractors = personnelSummary?.contractors ?? 0;
  const totalOccupancy = employees + contractors;

  const zonesByFloor = groupZonesByFloor(zoneBreakdown);

  return (
    <Container fluid>
      {/* 1. Summary Cards */}
      <SummaryCards
        totalOccupancy={totalOccupancy}
        employeeCount={employees}
        contractorCount={contractors}
      />

      {/* 2. Occupancy Summary */}
      <h2 className="mt-4 mb-3">Occupancy Summary</h2>
      <Row>
        <Col md={8}>
          <SummaryChart summary={summaryData} />
        </Col>
        <Col md={4}>
          <Card>
            <Card.Header>Zone Totals</Card.Header>
            <ListGroup variant="flush">
              {summaryData.map((z, i) => (
                <ListGroup.Item key={i}>
                  {z.zone}: {z.count}
                </ListGroup.Item>
              ))}
            </ListGroup>
          </Card>
        </Col>
      </Row>

      {/* 3. Floor-wise Zone Breakdown */}
      <h2 className="mt-5 mb-3">Floor-wise Zone Breakdown</h2>
      {Object.entries(zonesByFloor).map(([floor, zones]) => (
        <div key={floor} className="mb-4">
          <h4 className="mb-3">{floor}</h4>
          <Row>
            {zones.map((zone, idx) => (
              <Col key={idx} sm={6} md={4} lg={3}>
                <Card className="mb-3">
                  <Card.Body>
                    <Card.Title>{zone.zone}</Card.Title>
                    <Card.Text>
                      Occupancy: <strong>{zone.count}</strong>
                    </Card.Text>
                  </Card.Body>
                </Card>
              </Col>
            ))}
          </Row>
        </div>
      ))}

      {/* 4. Floor Chart */}
      <h2 className="mt-5 mb-3">Floor Occupancy Chart</h2>
      <FloorOccupancyChart data={floorData} />

      {/* 5. Personnel Breakdown */}
      <h2 className="mt-5 mb-3">Personnel Type Breakdown</h2>
      <PersonnelTypeBreakdownTable data={personnelBreakdown} />

      {/* 6. Details Link */}
      <div className="mt-4">
        <Link to="/details" className="btn btn-primary">
          View Full Zone Details
        </Link>
      </div>
    </Container>
  );
}










// src/pages/DashboardHome.jsx

import React from 'react';
import { Link } from 'react-router-dom';
import { Row, Col, Tabs, Tab, ListGroup, Card, Container } from 'react-bootstrap';

import SummaryCards from '../components/SummaryCards';
import SummaryChart from '../components/SummaryChart';
import FloorOccupancyChart from '../components/FloorOccupancyChart';
import ZoneBreakdownTable from '../components/ZoneBreakdownTable';
import PersonnelTypeBreakdownTable from '../components/PersonnelTypeBreakdownTable';
import ZoneDetailsTable from '../components/ZoneDetailsTable';

export default function DashboardHome({
  summaryData,
  detailsData,
  floorData,
  zoneBreakdown,
  personnelBreakdown,
  personnelSummary
}) {
  // card values
  const employees   = personnelSummary?.employees   ?? 0;
  const contractors = personnelSummary?.contractors ?? 0;
  const totalOccupancy = employees + contractors;

  return (
    <Container fluid>
      {/* 1. Top-level summary cards */}
      <SummaryCards
        totalOccupancy={totalOccupancy}
        employeeCount={employees}
        contractorCount={contractors}
      />

      {/* 2. Occupancy Summary section */}
      <h2 className="mt-4 mb-3">Occupancy Summary</h2>
      <Row>
        <Col md={8}>
          <SummaryChart summary={summaryData} />
        </Col>
        <Col md={4}>
          <Card>
            <Card.Header>Zone Totals</Card.Header>
            <ListGroup variant="flush">
              {summaryData.map((z, i) => (
                <ListGroup.Item key={i}>
                  {z.zone}: {z.count}
                </ListGroup.Item>
              ))}
            </ListGroup>
          </Card>
        </Col>
      </Row>

      {/* 3. Floor-wise Occupancy */}
      <h2 className="mt-5 mb-3">Floor-wise Occupancy</h2>
      <FloorOccupancyChart data={floorData} />

      {/* 5. Personnel Type Breakdown */}
      <h2 className="mt-5 mb-3">Personnel Type Breakdown</h2>
      <PersonnelTypeBreakdownTable data={personnelBreakdown} />

     
      <div className="mt-3">
        <Link to="/details" className="btn btn-primary">
          View Full Zone Details
        </Link>
      </div>
    </Container>
  );
}



