// controllers/liveOccupancyController.js
// … keep your imports, pool setup, etc. …

/** Normalize the raw door + direction into your map’s key format */
function normalizeZoneKey(rawDoor, rawDir) {
  const base = String(rawDoor || '')
    .trim()
    .replace(/\s+/g, ' ')
    .toUpperCase();
  // explicitly distinguish In vs Out
  const dir = (rawDir === 'InDirection') ? 'InDirection' : 'OutDirection';
  return `${base}___${dir}`;
}

/**
 * Map a swipe’s door+direction → zone.
 * 1) Try explicit lookup in doorZoneMap;
 * 2) If it’s a Pune door (APAC_IN_PUN_), auto-extract zone or color;
 * 3) If OutDirection, append “ - Outer Area” or appropriate “Out of office” logic;
 * 4) Otherwise warn once & return “Unknown Zone”.
 */
function mapDoorToZone(rawDoor, rawDir) {
  const key = normalizeZoneKey(rawDoor, rawDir);

  // 1) explicit Excel-derived mapping wins every time
  if (doorZoneMap[key]) {
    return doorZoneMap[key];
  }

  // 2) Pune fallback
  const up = String(rawDoor || '').toUpperCase();
  if (up.startsWith('APAC_IN_PUN_')) {
    const rest    = up.slice('APAC_IN_PUN_'.length);
    const paren   = rest.match(/\(([^)]+)\)/);
    let zoneName;

    if (paren) {
      // e.g. “(RED)” → “RED ZONE”
      zoneName = paren[1].toUpperCase() + ' ZONE';
    } else {
      // otherwise fall back to splitting by underscore or space
      const parts     = rest.split(/[\s_]+/).filter(Boolean);
      const maybeZone = parts[1] || parts[0] || '';
      if (/RECEPTION/.test(maybeZone)) {
        zoneName = 'Reception Area';
      } else {
        // e.g. “GSOC” → “Gsoc Zone” → then uppercase “GSOC Zone”
        const z = maybeZone.charAt(0).toUpperCase() + maybeZone.slice(1).toLowerCase();
        zoneName = z.endsWith('Zone') ? z : z.toUpperCase() + ' ZONE';
      }
    }

    // 3) if it’s an OutDirection swipe, append “ - Outer Area”
    if (rawDir === 'OutDirection') {
      // special case: some doors really eject out-of-office entirely
      if (zoneName === 'Reception Area') {
        return 'Out of office';
      }
      return zoneName + ' - Outer Area';
    }

    return zoneName;
  }

  // 4) truly unknown patterns → Warn & “Unknown Zone”
  if (!warnedKeys.has(key)) {
    console.warn('⛔ Unmapped door-zone key:', key);
    warnedKeys.add(key);
  }
  return 'Unknown Zone';
}

// … the rest of your controller remains unchanged …








/** Normalize the raw door + direction into your map’s key format */
function normalizeZoneKey(rawDoor, rawDir) {
  const base = String(rawDoor || '')
    .trim()
    .replace(/\s+/g, ' ')
    .toUpperCase();
  // const dir = /IN/i.test(rawDir) ? 'InDirection' : 'OutDirection';
   const dir = (rawDir ==='InDirection') ? 'InDirection' : 'OutDirection';
  return `${base}___${dir}`;
}

/**
 * 1) explicit lookup from doorZoneMap;
 * 2) if starts APAC_IN_PUN, extract floor N or parenthesized zone;
 * 3) otherwise warn once & return “Unknown Zone”
 */
function mapDoorToZone(rawDoor, rawDir) {
  const key = normalizeZoneKey(rawDoor, rawDir);
  if (doorZoneMap[key]) {
    return doorZoneMap[key];
  }

  const up = String(rawDoor || '').toUpperCase();
  if (up.startsWith('APAC_IN_PUN_')) {
    const rest = up.slice('APAC_IN_PUN_'.length);
    // parenthesized zone e.g. "(RED)"
    const paren = rest.match(/\(([^)]+)\)/);
    if (paren) {
      return paren[1].toUpperCase() + (paren[1].toUpperCase()===paren[1]? ' ZONE':' Zone');
    }
    // otherwise floor + zone in text, floor is number+suffix or word e.g. "2NDFLR" or "PODIUM"
    const parts = rest.split(/[\s_]+/).filter(Boolean);
    // If first token is floor like "12." or "2NDFLR" or "TOWER"
    const maybeFloor = parts[0].match(/^(\d+)(ST|ND|RD|TH)?FLR?$/) ? parts[0] : null;
    const zoneToken   = parts[1] || parts[0];
    if (zoneToken) {
      const z = zoneToken.charAt(0) + zoneToken.slice(1).toLowerCase();
      if (/RECEPTION/.test(zoneToken)) return 'Reception Area';
      return z.includes('Zone')? z : (z.toUpperCase() + ' Zone');
    }
    // fallback
    if (!warnedKeys.has(key)) {
      console.warn('⛔ Unmapped APAC_IN_PUN door:', rawDoor, rawDir);
      warnedKeys.add(key);
    }
    return 'Unknown Zone';
  }

  if (!warnedKeys.has(key)) {
    console.warn('⛔ Unmapped door-zone key:', key);
    warnedKeys.add(key);
  }
  return 'Unknown Zone';
}









read Strickly Each door name and zone to Floor map carefully and line by line and .
I want create only Zone Which is defined in front of door nad create only floor Which is display in the Defined then use diffrent diffrent logic .understand door name flow read each direction 
carefully then give me updated js file logic carefully


C:\Users\W0024618\Desktop\swipeData\employee-ai-insights\data\doorZoneMap.js

// Auto-generated from punedoor.xlsx

function mapDoorToZone(door, direction,zone) {
  const key = `${door}___${direction}__${zone}`;
  return doorZoneMap[key];
}

const doorZoneMap = {
  "APAC_IN_PUN_PODIUM_RED_IDF ROOM-02-Restricted Door___InDirection": "RED ZONE",
  
  "APAC_IN_PUN_PODIUM_ST2 DOOR 1 (RED)___InDirection": "RED ZONE",
  "APAC_IN_PUN_PODIUM_ST2 DOOR 1 (RED)___OutDirection": "RED ZONE",
  "APAC_IN_PUN_PODIUM_RED_MAIN LIFT LOBBY ENTRY 1-DOOR___InDirection": "RED ZONE",
  "APAC_IN_PUN_PODIUM_RED_MAIN LIFT LOBBY ENTRY 1-DOOR___OutDirection": "Out of office",
  "APAC_IN_PUN_PODIUM_ST 1-DOOR 1 (RED)___InDirection": "RED ZONE",

  "APAC_IN_PUN_PODIUM_ST2 DOOR 2 (YELLOW)___InDirection": "Yellow zone",
  "APAC_IN_PUN_PODIUM_ST2 DOOR 2 (YELLOW)___OutDirection": "Yellow zone",
  "APAC_IN_PUN_PODIUM_P-1 TURNSTILE 1-DOOR___InDirection": "Reception Area",

  "APAC_IN_PUN_PODIUM_P-1 TURNSTILE 2-DOOR___InDirection": "Reception Area",

  "APAC_IN_PUN_PODIUM_P-1 TURNSTILE 3-DOOR___InDirection": "Reception Area",
  
  "APAC_IN_PUN_PODIUM_P-1 TURNSTILE 4-DOOR___InDirection": "Reception Area",
  
  "APAC_IN_PUN_PODIUM_YELLOW_MDF Restricted Door___InDirection": "Yellow zone",

  "APAC_IN_PUN_PODIUM_YELLOW_IT STORE ROOM-DOOR Restricted door___InDirection": "Yellow zone",

  "APAC_IN_PUN_PODIUM_GSOC DOOR Restricted door___InDirection": "GSOC",

  "APAC_IN_PUN_PODIUM_YELLOW_REPRO STORE-DOOR Restricted door___InDirection": "Yellow zone",
  
  "APAC_IN_PUN_PODIUM_YELLOW_CONTROL PANEL ROOM-DOOR Restricted door___InDirection": "Yellow zone",
  
  "APAC_IN_PUN_PODIUM_YELLOW_PREACTION ROOM-DOOR Restricted door___InDirection": "Yellow zone",
  
  "APAC_IN_PUN_PODIUM_YELLOW_RECEPTION ENTRY-DOOR___InDirection": "Yellow zone",
  "APAC_IN_PUN_PODIUM_YELLOW_RECEPTION ENTRY-DOOR___OutDirection": "Reception Area",

  "APAC_IN_PUN_PODIUM_YELLOW_TESTING LAB-DOOR Restricted door___InDirection": "Yellow zone",
  
  "APAC_IN_PUN_PODIUM_GREEN-_IDF ROOM 1-Restricted Door___InDirection": "Green Zone",
  
  "APAC_IN_PUN_PODIUM_GREEN_UPS ENTRY 1-DOOR Restricted door___InDirection": "Green Zone",
  
  "APAC_IN_PUN_PODIUM_GREEN_UPS ENTRY 2-DOOR Restricted door___InDirection": "Green Zone",
  
  "APAC_IN_PUN_PODIUM_GREEN_LOCKER HR STORE 3-DOOR Restricted door___InDirection": "Green Zone",
  
  "APAC_IN_PUN_PODIUM_ST4 DOOR 2 (GREEN)___InDirection": "Green Zone",
  
  "APAC_IN_PUN_PODIUM_ST4 DOOR 1 (ORANGE)___InDirection": "Orange Zone",

  "APAC_IN_PUN_PODIUM_GREEN-MAIN LIFT LOBBY-DOOR___InDirection": "Green Zone",
  "APAC_IN_PUN_PODIUM_GREEN-MAIN LIFT LOBBY-DOOR___OutDirection": "Green Zone",
  "APAC_IN_PUN_PODIUM_ST3 DOOR 2 (GREEN)___InDirection": "Green Zone",
  "APAC_IN_PUN_PODIUM_ST3 DOOR 2 (GREEN)___OutDirection": "Green Zone",

  "APAC_IN_PUN_PODIUM_GREEN_RECEPTION ENTRY-DOOR___InDirection": "Green Zone",
  "APAC_IN_PUN_PODIUM_GREEN_RECEPTION ENTRY-DOOR___OutDirection": "Reception Area",

  "APAC_IN_PUN_PODIUM_ORANGE_RECEPTION ENTRY-DOOR___InDirection": "Orange Zone",
  "APAC_IN_PUN_PODIUM_ORANGE_RECEPTION ENTRY-DOOR___OutDirection": "Reception Area",

  "APAC_IN_PUN_PODIUM_ST3_DOOR 1 (ORANGE)___InDirection": "Orange Zone",
  "APAC_IN_PUN_PODIUM_ST3_DOOR 1 (ORANGE)___OutDirection": "Orange Zone",

  "APAC_IN_PUN_PODIUM_ORANGE_MAIN LIFT LOBBY-DOOR___InDirection": "Orange Zone",
  "APAC_IN_PUN_PODIUM_ORANGE_MAIN LIFT LOBBY-DOOR___OutDirection": "Orange Zone",

  "APAC_IN_PUN_PODIUM_ORANGE-IDF ROOM 3-Restricted Door___InDirection": "Orange Zone",
  

  "APAC_IN_PUN_2NDFLR_IDF ROOM_10:05:86 Restricted Door___InDirection": "2nd Floor, Pune",
  


  "APAC_IN_PUN_2NDFLR_UPS/ELEC ROOM Restricted Door_10:05:FE___InDirection": "2nd Floor, Pune",
  

  "APAC_IN_PUN_2NDFLR_RECPTION TO WORKSTATION DOOR_10:05:4B___InDirection": "2nd Floor, Pune",
  "APAC_IN_PUN_2NDFLR_RECPTION TO WORKSTATION DOOR_10:05:4B___OutDirection": "Out of office",

  "APAC_IN_PUN_2NDFLR_LIFTLOBBY TO RECEPTION EMTRY DOOR_10:05:74___InDirection": "2nd Floor, Pune",
  "APAC_IN_PUN_2NDFLR_LIFTLOBBY TO RECEPTION EMTRY DOOR_10:05:74___OutDirection": "2nd Floor, Pune",

  "APAC_IN_PUN_PODIUM_RED_RECEPTION TO WS ENTRY 1-DOOR NEW___InDirection": "RED ZONE",
  "APAC_IN_PUN_PODIUM_RED_RECEPTION TO WS ENTRY 1-DOOR NEW___OutDirection": "Reception Area",

  "APAC_IN_PUN_PODIUM_YELLOW_MAIN LIFT LOBBY-DOOR NEW___InDirection": "Yellow zone",
  "APAC_IN_PUN_PODIUM_YELLOW_MAIN LIFT LOBBY-DOOR NEW___OutDirection": "Out of office",

  "APAC_IN_PUN_PODIUM_ST 1 DOOR 2 (YELLOW)___InDirection": "Yellow zone",
  "APAC_IN_PUN_PODIUM_ST 1 DOOR 2 (YELLOW)___OutDirection": "Yellow Zone",

  "APAC_IN_PUN_PODIUM_ORANGE_KITCHENETTE FIRE EXIT-DOOR NEW___InDirection": "Green Zone",
  "APAC_IN_PUN_PODIUM_ORANGE_KITCHENETTE FIRE EXIT-DOOR NEW___OutDirection": "Green Zone - Outer Area",

  "APAC_IN_PUN_PODIUM_YELLOW_FIRE EXIT 1-DOOR NEW___InDirection": "Yellow zone",
  "APAC_IN_PUN_PODIUM_YELLOW_FIRE EXIT 1-DOOR NEW___OutDirection": "Yellow Zone - Outer Area",

  "APAC_IN_PUN_PODIUM_RED_RECREATION AREA FIRE EXIT 1-DOOR NEW___InDirection": "RED ZONE",
  "APAC_IN_PUN_PODIUM_RED_RECREATION AREA FIRE EXIT 1-DOOR NEW___OutDirection": "Yellow Zone - Outer Area",


  "APAC_IN_PUN_PODIUM_MAIN PODIUM RIGHT ENTRY-DOOR NEW___InDirection": "Reception Area",
  "APAC_IN_PUN_PODIUM_MAIN PODIUM RIGHT ENTRY-DOOR NEW___OutDirection": "Assembly Area -Podium",


  "APAC_IN_PUN_PODIUM_MAIN PODIUM LEFT ENTRY-DOOR NEW___InDirection": "Reception Area",
  "APAC_IN_PUN_PODIUM_MAIN PODIUM LEFT ENTRY-DOOR NEW___OutDirection": "Assembly Area - Podium",

  
  "APAC_IN_PUN_PODIUM_P-1 TURNSTILE 2 -OUT DOOR___OutDirection": "Out of Office",


  "APAC_IN_PUN-PODIUM_P-1 TURNSTILE 3 -OUT DOOR___OutDirection": "Out of Office",


  "APAC_IN_PUN_PODIUM_P-1 TURNSTILE 4 -OUT DOOR___OutDirection": "Out of Office",

  
  "APAC_IN_PUN_PODIUM_P-1 TURNSTILE 1-OUT DOOR___OutDirection": "Out of Office",


  "APAC_IN_PUN_TOWER B_MAIN RECEPTION DOOR___InDirection": "Tower B",
  "APAC_IN_PUN_TOWER B_MAIN RECEPTION DOOR___OutDirection": "Out of office",


  "APAC_IN_PUN_TOWER B_LIFT LOBBY DOOR___InDirection": "Tower B",
  "APAC_IN_PUN_TOWER B_LIFT LOBBY DOOR___OutDirection": "Out of office",


  "APAC_IN_PUN_TOWER B_ST6_GYM SIDE DOOR___InDirection": "Tower B",
  "APAC_IN_PUN_TOWER B_ST6_GYM SIDE DOOR___OutDirection": "Tower B",


  "APAC_IN_PUN_TOWER B_ST6_WKS SIDE DOOR___InDirection": "Tower B",
  "APAC_IN_PUN_TOWER B_ST6_WKS SIDE DOOR___OutDirection": "Tower B",

  "APAC_IN_PUN_TOWER B_ST5_KAPIL DEV DOOR___InDirection": "Tower B",
  "APAC_IN_PUN_TOWER B_ST5_KAPIL DEV DOOR___OutDirection": "Tower B",

  "APAC_IN_PUN_TOWER B_ST5_WKS SIDE DOOR___InDirection": "Tower B",
  "APAC_IN_PUN_TOWER B_ST5_WKS SIDE DOOR___OutDirection": "Tower B",

  "APAC_IN_PUN_TOWER B_RECEPTION LEFT DOOR___InDirection": "Tower B",
  "APAC_IN_PUN_TOWER B_RECEPTION LEFT DOOR___OutDirection": "Reception Area Tower B",

  "APAC_IN_PUN_TOWER B_RECEPTION RIGHT DOOR___InDirection": "Tower B",
  "APAC_IN_PUN_TOWER B_RECEPTION RIGHT DOOR___OutDirection": "Reception Area Tower B",

  "APAC_IN_PUN_TOWER B_IBMS ROOM___InDirection": "Tower B",


  "APAC_IN_PUN_TOWER B_UPS ROOM___InDirection": "Tower B",


  "APAC_IN_PUN_TOWER B_MDF ROOM___InDirection": "Tower B",



  "APAC_IN_PUN_TOWER B_PAC ROOM___InDirection": "Tower B",
  


  "APAC_IN_PUN_TOWER B_IT STORE ROOM___InDirection": "Tower B",
  

  "APAC_IN_PUN_TOWER B_GYM ROOM___InDirection": "Tower B GYM",
  "APAC_IN_PUN_TOWER B_GYM ROOM___OutDirection": "Tower B GYM"
};

module.exports = doorZoneMap;




C:\Users\W0024618\Desktop\swipeData\employee-ai-insights\data\zoneFloorMap.js



const zoneFloorMap = {
  "RED ZONE": "Podium Floor",
  "Yellow zone": "Podium Floor",
  "Reception Area": "Podium Floor",
  "Green Zone": "Podium Floor",
  "Orange Zone": "Podium Floor",
  "GSOC":"Podium Floor",
  "2nd Floor, Pune": "2nd Floor",
  "Green - Outer": "Podium Floor",
  "Yellow - Outer": "Podium Floor",
  "Assembly Area": "Podium Floor",
  "Tower B": "Tower B",
  "Reception Area Tower B": "Tower B",
  "Tower B GYM": "Tower B",
  
  // ensure your “Unknown Zone” rolls up into Podium, too:
  "Unknown Zone": "Podium Floor"
};

module.exports = zoneFloorMap;

