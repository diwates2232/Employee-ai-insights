// … inside buildOccupancyForToday …

// ─── 5) Floor In/Out summary (strict doors only) ───────────────
const validEvents = allEvents
  .filter(e => isTodayInDenver(e.Dateonly))
  .filter(evt => {
    // Strip any hex-time suffix, then normalize
    const doorNoSuffix = stripTimeSuffix(evt.Door.trim());
    const key = normalizeKey(doorNoSuffix, evt.Direction.trim());
    // Only keep if you explicitly listed it (IN or OUT) in strictDoorList.js
    return normalizedMonitoredKeys.has(key);
  });

const dedupedMap = new Map();
validEvents.forEach(evt => {
  const floor = mapDoorToFloor(evt.Door, evt.Direction);
  const mapKey = `${evt.PersonGUID || evt.EmployeeID}___${floor}___${evt.Direction}`;
  const prev   = dedupedMap.get(mapKey);
  const now    = DateTime.fromFormat(evt.Swipe_Time, 'HH:mm:ss');
  if (!prev || now > DateTime.fromFormat(prev.Swipe_Time, 'HH:mm:ss')) {
    dedupedMap.set(mapKey, evt);
  }
});

const floorMapIO = {};
Array.from(dedupedMap.values()).forEach(evt => {
  const floor = mapDoorToFloor(evt.Door, evt.Direction);

  // never include Out of office
  if (floor === 'Out of office') return;

  // Initialize if needed
  floorMapIO[floor] = floorMapIO[floor] || {
    inSwipes:  0,
    outSwipes: 0,
    inSet:     new Set(),
    outSet:    new Set()
  };

  // Count exactly those you listed
  if (evt.Direction === 'InDirection') {
    floorMapIO[floor].inSwipes++;
    floorMapIO[floor].inSet.add(evt.PersonGUID || evt.EmployeeID || evt.CardNumber);
  } else { // OutDirection
    floorMapIO[floor].outSwipes++;
    floorMapIO[floor].outSet.add(evt.PersonGUID || evt.EmployeeID || evt.CardNumber);
  }
});

const floorInOutSummary = Object.entries(floorMapIO).map(([floor, stats]) => {
  const inOnly = [...stats.inSet].filter(id => !stats.outSet.has(id));
  return {
    floor,
    inSwipes:      stats.inSwipes,
    outSwipes:     stats.outSwipes,
    inOnlyCount:   inOnly.length,
    inOnlyPersons: inOnly
  };
});













const validEvents = allEvents
  .filter(e => isTodayInDenver(e.Dateonly))
  .filter(evt => {
    // 1) strip off any "_HH:MM:SS" hex suffix
    const doorNoSuffix = stripTimeSuffix(evt.Door.trim());
    // 2) normalize against your strict list
    const key = normalizeKey(doorNoSuffix, evt.Direction.trim());
    return normalizedMonitoredKeys.has(key);
  });




- .filter(evt =>
-   normalizedMonitoredKeys.has(
-     normalizeKey(evt.Door, evt.Direction)
-   )
- );
+ .filter(evt => {
+   const doorNoSuffix = stripTimeSuffix(evt.Door.trim());
+   const key = normalizeKey(doorNoSuffix, evt.Direction.trim());
+   return normalizedMonitoredKeys.has(key);
+ });










module.exports = {
  monitoredDoors: {
    'US.CO.HQ. 12. South Lobby Doors-IN': 'InDirection',
    'US.CO.HQ. 12. North Stairwell-IN': 'InDirection',
    'US.CO.HQ. 12. Freight Elevator Lobby-IN': 'InDirection',
    'US.CO.HQ. 12. South Stairwell-IN': 'InDirection',
    'US.CO.HQ. 11. North Stairwell-IN': 'InDirection',
    'US.CO.HQ. 11. Freight Elevator Lobby-IN':'InDirection',
    'US.CO.HQ. 11. South Stairwell-IN': 'InDirection',
    'US.CO.HQ. 09. South Stairwell-IN': 'InDirection',
    'US.CO.HQ. 09. Freight Elevator Lobby-IN': 'InDirection',
    'US.CO.HQ. 09. North Stairwell-IN': 'InDirection',
    'US.CO.HQ. 12. North Lobby Doors-IN': 'InDirection',
    'US.CO.HQ. 11. North Lobby Doors-IN': 'InDirection',
    'US.CO.HQ. 11. South Lobby Doors-IN': 'InDirection',
    'US.CO.HQ. 09. North Lobby Doors-IN': 'InDirection',
    'US.CO.HQ. 09. South Lobby Doors-IN': 'InDirection',
    'US.CO.HQ. 13. Freight Elevator Lobby-IN': 'InDirection',
    'US.CO.HQ. 13. South Lobby Doors-IN': 'InDirection',
    'US.CO.HQ. 13. North Stairwell-IN': 'InDirection',
    'US.CO.HQ. 13. North Lobby Doors-IN':'InDirection',
    'US.CO.HQ. 13. South Stairwell-IN':'InDirection',
    'US.CO.HQ. 06. East Stairwell-IN':'InDirection',
    'US.CO.HQ. 15. North Lobby Doors-IN':'InDirection',
    'US.CO.HQ. 14. North Lobby Doors-IN':'InDirection',
    'US.CO.HQ. 14. South Lobby Doors-IN':'InDirection',
    'US.CO.HQ. 14. North Stairwell-IN':'InDirection',
    'US.CO.HQ. 14. Freight Elevator Lobby-IN':'InDirection',
    'US.CO.HQ. 14. South Stairwell-IN':'InDirection',
    'US.CO.HQ. 15. South Stairwell-IN':'InDirection',
    'US.CO.HQ. 15. Freight Elevator Lobby Left-IN':'InDirection',
    'US.CO.HQ. 15. South Lobby Doors-IN':'InDirection',
    'US.CO.HQ. 15. Freight Elevator Lobby East Door-IN':'InDirection',
    'US.CO.HQ. 15. Freight Elevator Lobby Right Door-IN':'InDirection',
    'US.CO.HQ. 15. North Stairwell-IN':'InDirection',
'US.CO.HQ. 06. North Entry-OUT':'OutDirection',
'US.CO.HQ. 06. East Stairwell-OUT':'OutDirection',
'US.CO.HQ. 09. Freight Elevator Lobby-OUT':'OutDirection',
'US.CO.HQ. 09. North Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 09. North Stairwell-OUT':'OutDirection',
'US.CO.HQ. 09. South Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 09. South Stairwell-OUT':'OutDirection',
'US.CO.HQ. 11. Freight Elevator Lobby-OUT':'OutDirection',
'US.CO.HQ. 11. North Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 11. North Stairwell-OUT':'OutDirection',
'US.CO.HQ. 11. South Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 11. South Stairwell-OUT':'OutDirection',
'US.CO.HQ. 12. Freight Elevator Lobby-OUT':'OutDirection',
'US.CO.HQ. 12. North Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 12. North Stairwell-OUT':'OutDirection',
'US.CO.HQ. 12. South Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 12. South Stairwell-OUT':'OutDirection',
'US.CO.HQ. 13. Freight Elevator Lobby-OUT':'OutDirection',
'US.CO.HQ. 13. North Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 13. North Stairwell-OUT':'OutDirection',
'US.CO.HQ. 13. South Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 13. South Stairwell-OUT':'OutDirection',
'US.CO.HQ. 14. Freight Elevator Lobby-OUT':'OutDirection',
'US.CO.HQ. 14. North Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 14. North Stairwell-OUT':'OutDirection',
'US.CO.HQ. 14. South Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 14. South Stairwell-OUT':'OutDirection',
'US.CO.HQ. 15. Freight Elevator Lobby East Door-OUT':'OutDirection',
'US.CO.HQ. 15. Freight Elevator Lobby Left-OUT':'OutDirection',
'US.CO.HQ. 15. Freight Elevator Lobby Right Door-OUT':'OutDirection',
'US.CO.HQ. 15. North Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 15. North Stairwell-OUT':'OutDirection',
'US.CO.HQ. 15. South Lobby Doors-OUT':'OutDirection',
'US.CO.HQ. 15. South Stairwell-OUT':'OutDirection',


'US.CO.HQ. 06. South Center Hall Entry-OUT':'OutDirection',
'US.CO.HQ. 06. South Entrance-OUT':'OutDirection',
'US.CO.HQ. 01. Focus Area North-OUT':'OutDirection',
'US.CO.HQ. 01. Focus Area West-OUT':'OutDirection',

    // Add more doors as needed
  }
};
