const express         = require('express');
const cors            = require('cors');
const path            = require('path');

const employeeRoutes    = require('./routes/employeeRoutes');
const liveOccupancyRt   = require('./routes/liveOccupancyRoutes');

const app = express();
app.use(cors());
app.use(express.json());

// TEMP: make sure Express is picking up routes at all
app.get('/ping', (req, res) => res.send('pong'));

// mount each router on its own prefix
app.use('/api/employees', employeeRoutes);
app.use('/api/occupancy',  liveOccupancyRt);

// helper: safely walk the router stack if it exists
function listAllEndpoints(app) {
  const results = [];
  const stack = app._router && app._router.stack;
  if (!stack) return results;

  function recurse(layers, parentPath = '') {
    layers.forEach(layer => {
      // direct route
      if (layer.route && layer.route.path) {
        const methods = Object
          .keys(layer.route.methods)
          .map(m => m.toUpperCase());
        results.push({ path: parentPath + layer.route.path, methods });
      }
      // mounted router
      else if (layer.name === 'router' && layer.handle.stack) {
        // extract the mount path from the internal regexp
        const mountPath = layer.regexp.source
          .replace('^\\', '')
          .replace('\\/?(?=\\/|$)', '')
          .replace(/\\\//g, '/');
        recurse(layer.handle.stack, parentPath + mountPath);
      }
    });
  }

  recurse(stack);
  return results;
}

// ————— DEBUG: list all registered endpoints —————
const endpoints = listAllEndpoints(app);
if (endpoints.length) {
  console.log('\n📋 Registered endpoints:');
  endpoints.forEach(e =>
    console.log(`  ${e.methods.join(',')}\t${e.path}`)
  );
} else {
  console.warn('⚠️ No endpoints found on app._router.stack');
}

// serve React build
const buildPath = path.join(__dirname, '..', 'client', 'build');
app.use(express.static(buildPath));

// health check
app.get('/health', (req, res) => res.send('OK'));

const PORT = process.env.PORT || 5000;
app.listen(PORT, () =>
  console.log(`Server running at http://localhost:${PORT}`)
);










const express = require('express');
const router = express.Router();
const { getEmployeeData } = require('../controllers/employeeController');

router.get('/employees', getEmployeeData);

module.exports = router;



// routes/liveOccupancyRoutes.js

const express = require('express');
const router  = express.Router();
const { getLiveOccupancy } = require('../controllers/liveOccupancyController');

router.get('/live-occupancy',getLiveOccupancy);

module.exports = router;



if needed give me updated routes
